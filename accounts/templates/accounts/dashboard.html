{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - GradeNest</title>
  <link rel="icon" type="image/png" href="{% static 'accounts/img/gradenest-logo.png' %}" />
  <link rel="stylesheet" href="{% static 'accounts/css/dashboard.css' %}?v=2.0" />
  <link rel="stylesheet" href="{% static 'accounts/css/dashboard-compact.css' %}?v=2.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet" />
  <script src="{% static 'accounts/js/dashboard.js' %}?v=4.1" defer></script>
</head>
<body>

<div class="topbar">
  <div class="logo-section">
    <img src="{% static 'accounts/img/gradenest-logo.png' %}" alt="GradeNest Logo" class="logo-img" />
    <span class="logo-text">GradeNest</span>
  </div>

  <div class="profile-section">
    <span class="profile-name" id="topbarProfileName">{{ user.full_name|default:"User" }}</span>
    <div class="profile-icon-wrapper" id="profileDropdownToggle">
      <img src="{% static 'accounts/img/profile-icon.png' %}" alt="Profile" class="profile-icon" />
    </div>
    
    <div class="profile-dropdown" id="profileDropdown">
      <a href="#" class="dropdown-item" id="settingsLink">Settings</a>
      <a href="{% url 'accounts:logout' %}" class="dropdown-item logout-item">Logout</a>
    </div>
  </div>
</div>

<aside class="sidebar">
  <div class="sidebar-header">
    <div class="user-profile-card">
      <div class="user-avatar">
        <img src="{% static 'accounts/img/profile-icon.png' %}" alt="Profile" />
      </div>
      <div class="user-info">
        <span class="user-name">{{ user.first_name }}</span>
        <span class="user-level">{{ profile.grade_level|default:"Grade 7" }}</span>
      </div>
    </div>
  </div>

  <nav class="nav-menu">
    <div class="nav-section">
      <span class="nav-section-label">Main</span>
      <a href="{% url 'accounts:dashboard' %}" class="nav-item active" data-page="dashboard">
        <div class="nav-item-content">
          <img src="{% static 'accounts/img/home-icon.png' %}" alt="Home" class="nav-icon" />
          <span class="nav-label">Dashboard</span>
        </div>
        <span class="nav-indicator"></span>
      </a>
    </div>

    <div class="nav-section">
      <span class="nav-section-label">Academics</span>
      <a href="#" class="nav-item" data-page="school-year" id="schoolYearLink">
        <div class="nav-item-content">
          <img src="{% static 'accounts/img/sy-icon.png' %}" alt="School Year" class="nav-icon" />
          <span class="nav-label">School Years</span>
        </div>
        <span class="nav-badge">{{ profile.school_year|default:"2024-25" }}</span>
      </a>
      <a href="#" class="nav-item" data-page="goals" id="goalsLink">
        <div class="nav-item-content">
          <img src="{% static 'accounts/img/goals-icon.png' %}" alt="Goals" class="nav-icon" />
          <span class="nav-label">My Goals</span>
        </div>
        <span class="nav-count" id="goalsCount">0</span>
      </a>
    </div>

    <div class="nav-section">
      <span class="nav-section-label">Account</span>
      <a href="#" class="nav-item" data-page="settings" id="navSettingsLink">
        <div class="nav-item-content">
          <img src="{% static 'accounts/img/settings-icon.png' %}" alt="Settings" class="nav-icon" />
          <span class="nav-label">Settings</span>
        </div>
      </a>
    </div>
  </nav>

  <div class="sidebar-footer">
    <div class="quick-stats">
      <div class="stat-item">
        <span class="stat-value" id="sidebarGwa">--</span>
        <span class="stat-label">Current GWA</span>
      </div>
      <div class="stat-divider"></div>
      <div class="stat-item">
        <span class="stat-value" id="sidebarProgress">0%</span>
        <span class="stat-label">Year Progress</span>
      </div>
    </div>
    <a href="{% url 'accounts:logout' %}" class="btn-logout">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
        <polyline points="16 17 21 12 16 7"/>
        <line x1="21" y1="12" x2="9" y2="12"/>
      </svg>
      <span>Logout</span>
    </a>
  </div>
</aside>

<main class="main-content">
  <div class="content-wrapper">

    <!-- Breadcrumb Navigation -->
    <div class="breadcrumb-nav" id="breadcrumbNav">
      <span class="breadcrumb-item active" data-level="dashboard">Dashboard</span>
    </div>

    <!-- Dashboard View -->
    <div id="dashboardView" class="view-container active">
      <!-- Compact Header -->
      <div class="dashboard-header-compact">
        <div class="welcome-section">
          <h1 class="welcome-text">Welcome back, <span class="user-highlight">{{ user.first_name }}</span>! 👋</h1>
          <p class="date-badge" id="currentDate"></p>
        </div>
        <div class="school-year-pill">
          <span class="sy-icon">📅</span>
          <span class="sy-text">{{ profile.school_year|default:"2024-2025" }}</span>
        </div>
      </div>

      <!-- Main Dashboard Grid -->
      <div class="dashboard-grid">
        <!-- Left Column: Quarter Cards -->
        <div class="quarters-grid-compact" id="quartersContainer">
          <!-- Quarter cards will be dynamically generated here -->
          <!-- Grid layout: 2x2 for quarters -->
        </div>

        <!-- Right Column: Overall GWA Card -->
        <div class="overall-gwa-compact">
          <div class="gwa-card-header">
            <h3 class="gwa-title">Overall GWA</h3>
            <span class="gwa-subtitle">This School Year</span>
          </div>
          <div class="gwa-visual">
            <div class="gwa-ring-compact">
              <svg class="gwa-circle-svg" viewBox="0 0 160 160">
                <circle class="gwa-bg" cx="80" cy="80" r="70" stroke-width="12" fill="none"/>
                <circle class="gwa-progress" id="overallGwaCircle" cx="80" cy="80" r="70" 
                        stroke-width="12" fill="none" stroke-linecap="round"
                        stroke-dasharray="439.82" stroke-dashoffset="439.82"/>
              </svg>
              <div class="gwa-value-display">
                <span class="gwa-number" id="overallGwaValue">--</span>
                <span class="gwa-label">GWA</span>
              </div>
            </div>
          </div>
          <p class="gwa-remark" id="overallRemark">Keep pushing forward! 🌟</p>
          <button class="btn-complete-year" id="markDoneBtn">
            <span class="btn-icon">✓</span>
            Mark Year Complete
          </button>
          <span class="completion-hint hidden" id="buttonHint">All quarters completed</span>
        </div>
      </div>
    </div>

    <!-- Subjects View -->
    <div id="subjectsView" class="view-container">
      <div class="view-header">
        <button class="btn-back" id="backToQuarters">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Back to Quarters
        </button>
        <h2 id="subjectsViewTitle">First Quarter - Subjects</h2>
      </div>
      <div class="grade-legend">
        <span class="legend-title">Grade Scale:</span>
        <div class="legend-items">
          <span class="legend-item"><span class="legend-color" style="background-color: #10b981;"></span>90-100 Outstanding</span>
          <span class="legend-item"><span class="legend-color" style="background-color: #38CA79;"></span>85-89 Very Satisfactory</span>
          <span class="legend-item"><span class="legend-color" style="background-color: #3b82f6;"></span>80-84 Satisfactory</span>
          <span class="legend-item"><span class="legend-color" style="background-color: #f59e0b;"></span>75-79 Fairly Satisfactory</span>
          <span class="legend-item"><span class="legend-color" style="background-color: #ef4444;"></span>Below 75 Did Not Meet</span>
        </div>
      </div>
      <div class="subjects-grid" id="subjectsGrid"></div>
    </div>

    <!-- Subject Detail View -->
    <div id="subjectDetailView" class="view-container">
      <div class="view-header">
        <button class="btn-back" id="backToSubjects">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Back to Subjects
        </button>
        <div class="subject-detail-header">
          <div class="grade-display-section">
            <div class="grade-circle-container">
              <div class="grade-circle-wrapper">
                <svg class="grade-circle" viewBox="0 0 120 120">
                  <circle class="bg-circle" cx="60" cy="60" r="54" 
                          stroke-width="10" fill="none"/>
                  <circle class="progress-circle" id="initialGradeCircle" cx="60" cy="60" r="54" 
                          stroke-width="10" fill="none"
                          stroke-dasharray="339.29" 
                          stroke-dashoffset="339.29"
                          stroke-linecap="round"/>
                </svg>
                <div class="grade-circle-value" id="initialGradeDisplay">--</div>
                <div class="grade-circle-label">Initial</div>
              </div>
              <span class="grade-arrow">→</span>
              <div class="grade-circle-wrapper">
                <svg class="grade-circle" viewBox="0 0 120 120">
                  <circle class="bg-circle" cx="60" cy="60" r="54" 
                          stroke-width="10" fill="none"/>
                  <circle class="progress-circle" id="transmutedGradeCircle" cx="60" cy="60" r="54" 
                          stroke-width="10" fill="none"
                          stroke-dasharray="339.29" 
                          stroke-dashoffset="339.29"
                          stroke-linecap="round"/>
                </svg>
                </svg>
                <div class="grade-circle-value" id="transmutedGradeDisplay">--</div>
                <div class="grade-circle-label">Final</div>
              </div>
            </div>
          </div>
          <h2 id="subjectDetailTitle">Mathematics - Grade Components</h2>
        </div>
      </div>
      
      <div class="components-container">
        <div class="components-section">
          <div class="section-header">
            <h3>Grade Components</h3>
            <div class="grade-info">
              <span class="info-text">Component weights are based on DepEd standards</span>
            </div>
          </div>
          
          <!-- Component Tabs -->
          <div class="component-tabs">
            <button class="component-tab active" data-component="WW">
              <span class="tab-icon">📝</span>
              <span class="tab-label">Written Works</span>
            </button>
            <button class="component-tab" data-component="PT">
              <span class="tab-icon">📊</span>
              <span class="tab-label">Performance Tasks</span>
            </button>
            <button class="component-tab" data-component="QA">
              <span class="tab-icon">📋</span>
              <span class="tab-label">Quarterly Assessment</span>
            </button>
          </div>
          
          <div class="components-table-wrapper">
            <table class="components-table" id="componentsTable">
              <thead>
                <tr>
                  <th>Item Name</th>
                  <th>Score</th>
                  <th>Highest Possible Score</th>
                  <th>Percentage Score (%)</th>
                  <th>PS</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="componentsTableBody">
                <!-- Components will be added dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  </div>
</main>

<!-- Confirmation Modal -->
<div class="modal-overlay" id="confirmYearCompleteModal">
  <div class="modal-container">
    <div class="modal-header">
      <h3 class="modal-title">⚠️ Confirm Year Completion</h3>
    </div>
    <div class="modal-body">
      <p class="modal-message">Quarter has not yet finished. Are you sure to complete this school year?</p>
      <p class="modal-warning">This action cannot be undone.</p>
    </div>
    <div class="modal-footer">
      <button class="btn-modal-cancel" id="btnCancelYearComplete">Cancel</button>
      <button class="btn-modal-confirm" id="btnConfirmYearComplete">OK</button>
    </div>
  </div>
</div>

<script id="user-profile-data" type="application/json">
{
  "gradeLevel": "{{ profile.grade_level|default:'Grade 7' }}",
  "strand": "{{ profile.strand|default:'' }}",
  "schoolYear": "{{ profile.school_year|default:'Not set' }}",
  "isJHS": {{ isJHS|yesno:"true,false" }},
  "isSHS": {{ isSHS|yesno:"true,false" }}
}
</script>
<script>
  // Parse user profile data from JSON
  window.userProfile = JSON.parse(document.getElementById('user-profile-data').textContent);
</script>

</body>
</html>