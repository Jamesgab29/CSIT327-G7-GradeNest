{% extends 'accounts/base.html' %}
{% load static %}
{% block title %}My Goals - GradeNest{% endblock %}
{% block extra_css %}
  <link rel="stylesheet" href="{% static 'accounts/css/goal.css' %}?v={{ CACHE_VERSION }}" />
{% endblock %}
{% block content %}
  {% csrf_token %}
  <div class="content-wrapper">

    <!-- Goals Header -->
    <div class="goals-header">
      <div class="goals-header-left">
        <h1 class="goals-title">My Goals</h1>
        <p class="goals-subtitle">Track and achieve your academic and personal milestones</p>
      </div>
      <button class="btn-add-goal" id="btnAddGoal">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M10 4v12M4 10h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        Add New Goal
      </button>
    </div>

    <!-- Goals Stats -->
    <div class="goals-stats">
      <div class="stat-card">
        <div class="stat-icon active">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M12 2L2 7l10 5 10-5-10-5z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M2 17l10 5 10-5M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="stat-content">
          <span class="stat-value" id="activeGoalsCount">0</span>
          <span class="stat-label">Active Goals</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon completed">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M22 11.08V12a10 10 0 11-5.93-9.14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M22 4L12 14.01l-3-3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="stat-content">
          <span class="stat-value" id="completedGoalsCount">0</span>
          <span class="stat-label">Completed</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon overdue">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
            <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="stat-content">
          <span class="stat-value" id="overdueGoalsCount">0</span>
          <span class="stat-label">Overdue</span>
        </div>
      </div>
    </div>

    <!-- Filter and Sort Controls -->
    <div class="goals-controls">
      <div class="filter-group">
        <label for="categoryFilter" class="control-label">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M2 4h12M4 8h8M6 12h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          Filter by Category
        </label>
        <select id="categoryFilter" class="control-select">
          <option value="all">All Categories</option>
          <option value="Academic">Academic</option>
          <option value="Personal">Personal</option>
          <option value="Health">Health</option>
          <option value="Career">Career</option>
          <option value="Other">Other</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="sortOrder" class="control-label">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M3 8h10M3 4h10M3 12h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          Sort by
        </label>
        <select id="sortOrder" class="control-select">
          <option value="date-asc">Target Date (Nearest)</option>
          <option value="date-desc">Target Date (Farthest)</option>
          <option value="created-desc">Recently Added</option>
          <option value="created-asc">Oldest First</option>
        </select>
      </div>
      <div class="goals-count-display">
        <span id="filteredCount">0</span> goals displayed
      </div>
    </div>

    <!-- Goals List -->
    <div class="goals-section">
      <h2 class="section-title">Active Goals</h2>
      <div class="goals-grid" id="activeGoalsList">
        <!-- Active goals will be inserted here -->
      </div>
    </div>

    <div class="goals-section">
      <h2 class="section-title">Completed Goals</h2>
      <div class="goals-grid" id="completedGoalsList">
        <!-- Completed goals will be inserted here -->
      </div>
    </div>

  </div>

<!-- Add/Edit Goal Modal -->
<div class="modal-overlay" id="goalModal">
  <div class="modal-container">
    <div class="modal-header">
      <h3 class="modal-title" id="modalTitle">Add New Goal</h3>
      <button class="btn-close-modal" id="btnCloseModal">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    <div class="modal-body">
      <form id="goalForm">
        <input type="hidden" id="goalId" />
        
        <div class="form-group">
          <label class="form-label" for="goalTitle">
            Title <span class="required-mark">*</span>
          </label>
          <input 
            type="text" 
            id="goalTitle" 
            class="form-input" 
            placeholder="e.g., Achieve 95% GWA this quarter"
            required
          />
          <span class="form-error" id="titleError"></span>
        </div>

        <div class="form-group">
          <label class="form-label" for="goalDescription">
            Description
          </label>
          <textarea 
            id="goalDescription" 
            class="form-textarea" 
            rows="4"
            placeholder="Describe your goal in detail..."
          ></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="goalCategory">
              Category <span class="required-mark">*</span>
            </label>
            <select id="goalCategory" class="form-select" required>
              <option value="">Select Category</option>
              <option value="Academic">Academic</option>
              <option value="Personal">Personal</option>
              <option value="Health">Health</option>
              <option value="Career">Career</option>
              <option value="Other">Other</option>
            </select>
            <span class="form-error" id="categoryError"></span>
          </div>

          <div class="form-group">
            <label class="form-label" for="goalTargetDate">
              Target Date <span class="required-mark">*</span>
            </label>
            <input 
              type="date" 
              id="goalTargetDate" 
              class="form-input"
              required
            />
            <span class="form-error" id="dateError"></span>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" id="btnCancelGoal">Cancel</button>
          <button type="submit" class="btn-save" id="btnSaveGoal">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path d="M13.333 4L6 11.333 2.667 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Save Goal
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" id="deleteModal">
  <div class="modal-container delete-modal">
    <div class="modal-header">
      <h3 class="modal-title">Delete Goal</h3>
    </div>
    <div class="modal-body">
      <div class="delete-warning">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
          <circle cx="24" cy="24" r="22" stroke="#ef4444" stroke-width="3"/>
          <path d="M24 14v14M24 34h.02" stroke="#ef4444" stroke-width="3" stroke-linecap="round"/>
        </svg>
      </div>
      <p class="delete-message">Are you sure you want to delete this goal?</p>
      <p class="delete-submessage">This action cannot be undone.</p>
    </div>
    <div class="modal-footer">
      <button class="btn-modal-cancel" id="btnCancelDelete">Cancel</button>
      <button class="btn-modal-delete" id="btnConfirmDelete">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path d="M2 4h12M5.333 4V2.667a1.333 1.333 0 011.334-1.334h2.666a1.333 1.333 0 011.334 1.334V4m2 0v9.333a1.333 1.333 0 01-1.334 1.334H4.667a1.333 1.333 0 01-1.334-1.334V4h9.334z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Delete Goal
      </button>
    </div>
  </div>
</div>

<!-- Success Toast -->
<div class="toast success" id="successToast">
  <div class="toast-icon">
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
      <path d="M16.667 5L7.5 14.167 3.333 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </div>
  <div class="toast-content">
    <p class="toast-title">Success!</p>
    <p class="toast-message" id="successMessage">Operation completed successfully!</p>
  </div>
</div>

<!-- Error Toast -->
<div class="toast error" id="errorToast">
  <div class="toast-icon">
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
      <path d="M10 6v4M10 14h.01M19 10a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </div>
  <div class="toast-content">
    <p class="toast-title">Error</p>
    <p class="toast-message" id="errorMessage">An error occurred. Please try again.</p>
  </div>
</div>

{% endblock %}
{% block extra_js %}
  <script src="{% static 'accounts/js/goal.js' %}?v={{ CACHE_VERSION }}" defer></script>
{% endblock %}